"use strict";angular.module("myappApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngStorage"]).constant("urls",{BASE:"http://"+window.location.host+"/api/",BASE_API:"http://"+window.location.host+"/api/"}).config(["$routeProvider","$httpProvider","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/signin",{templateUrl:"views/signin.html",controller:"MainCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"MainCtrl"}).when("/restricted",{templateUrl:"views/restricted.html",controller:"RestrictedCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"}),b.defaults.useXDomain=!0,b.defaults.withCredentials=!0,delete b.defaults.headers.common["X-Requested-With"],b.interceptors.push(["$q","$location","$localStorage",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.token&&(a.headers.Authorization="Bearer "+c.token),a},responseError:function(c){return(401===c.status||403===c.status)&&b.path("/signin"),a.reject(c)}}}])}]).controller("AppCtrl",["$rootScope","$scope",function(a,b){a.login=!1,a["class"]="home",b.putClass=function(b){a["class"]=b}}]),angular.module("myappApp").controller("MainCtrl",["$rootScope","$scope","$location","$localStorage","Auth",function(a,b,c,d,e){function f(a){d.token=a.meta.token,window.location.href="#/restricted"}d.token>1&&(window.location.href="#/restricted"),b.signin=function(){var c={username:b.username,password:b.password};e.signin(c,f,function(){a.error="Invalid credentials"})},b.signup=function(){var c={username:b.username,password:b.password};e.signup(c,f,function(){a.error="Failed to signup"})},b.logout=function(){a.login=!1,e.logout(function(){window.location="#/"})}}]),angular.module("myappApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("myappApp").controller("RestrictedCtrl",["$rootScope","$scope","Data","$localStorage","Auth",function(a,b,c,d,e){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.login=!0,b.logout=function(){a["class"]="home",a.login=!1,e.logout(function(){window.location.href="#/"})},"undefined"==typeof d.token?window.location.href="#/":(c.getRestrictedData(function(a){b.data=a.data?a.data:{}},function(){a.error="Failed to fectch restricted content."}),c.getApiData(function(a){b.api=a.data},function(){a.error="Failed to fetch restricted API content"}))}]),angular.module("myappApp").factory("Auth",["$http","$localStorage","urls",function(a,b,c){function d(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)}function e(){var a=b.token,c={};if("undefined"!=typeof a){var e=a.split(".")[1];c=JSON.parse(d(e))}return c}var f=e();return{signup:function(b,d,e){a.post(c.BASE+"auth/signup",b).success(d).error(e)},signin:function(b,d,e){a.post(c.BASE+"auth/login",b).success(d).error(e)},logout:function(a){f={},delete b.token,a()},getTokenClaims:function(){return f}}}]),angular.module("myappApp").factory("Data",["$http","urls",function(a,b){return{getRestrictedData:function(c,d){a.get(b.BASE+"users").success(c).error(d)},getApiData:function(c,d){a.get(b.BASE_API+"auth/test").success(c).error(d)}}}]);
